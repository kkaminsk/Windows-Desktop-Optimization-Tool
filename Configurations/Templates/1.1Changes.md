# WDOT v1.1 Changes - Windows 365 Cloud PC Optimization

This document outlines the changes required to the WDOT template configuration files for Windows 365 Cloud PC environments with Intune and Azure Monitor compatibility.

---

## Summary of Changes

| File | Action |
|------|--------|
| Services.json | Modify - protect telemetry services, add SMB services |
| ScheduledTasks.json | Modify - protect telemetry/compliance tasks |
| AppxPackages.json | Modify - keep productivity apps |
| DefaultUserSettings.json | Modify - enable notifications, keep Copilot, remove Edge update settings |
| PolicyRegSettings.json | Modify - protect telemetry policies, remove IE settings, remove Edge update settings |
| EdgeSettings.json | No changes required |
| LanManWorkstation.json | **REMOVE** - not needed for Cloud PC |
| Autologgers.json | No changes required |
| Windows_Optimization.ps1 | Modify - handle missing LanManWorkstation.json |

---

## Services.json

### Do NOT Disable (Keep OptimizationState as "Skip")

These services are required for Intune Endpoint Analytics and Azure Monitor:

| Service | Reason |
|---------|--------|
| `InstallService` | Required for Microsoft Store modern apps |
| `VSS` | Required for point-in-time restore capabilities |
| `DiagTrack` | **CRITICAL** - Primary telemetry service for Endpoint Analytics |
| `DPS` | Required for Diagnostic Policy Service |
| `WdiSystemHost` | Required for diagnostic hosting |
| `WerSvc` | Required for Windows Error Reporting / App Reliability |
| `DiagSvc` | Required for Diagnostic Execution |

### ADD New Services to Disable

Add these services for Windows 365 Cloud PC (no SMB file sharing needed):

```json
{
  "Name": "LanmanServer",
  "OptimizationState": "Apply",
  "Description": "Server service - not needed for Windows 365 Cloud PC without SMB file sharing"
},
{
  "Name": "LanmanWorkstation",
  "OptimizationState": "Apply",
  "Description": "Workstation service - not needed for Windows 365 Cloud PC without SMB file sharing"
}
```

---

## ScheduledTasks.json

### Do NOT Disable (Keep OptimizationState as "Skip")

These tasks are required for Intune/Azure Monitor telemetry and compliance:

| Task | Reason |
|------|--------|
| `*Compatibility*` | **CRITICAL** - Microsoft Compatibility Appraiser for Endpoint Analytics |
| `Microsoft-Windows-DiskDiagnosticDataCollector` | Required for disk diagnostic telemetry |
| `Consolidator` | Required for CEIP/telemetry data collection |
| `Sqm-Tasks` | Required for TPM/Secure Boot compliance reporting |
| `StartComponentCleanup` | Required for persistent VDI disk maintenance |
| `Restore` | Required for cloud settings sync on persistent VDI |

---

## AppxPackages.json

### Do NOT Remove (Keep OptimizationState as "Skip")

Keep these productivity applications:

| Package | Reason |
|---------|--------|
| `Microsoft.Copilot` | Microsoft AI assistant |
| `Microsoft.MicrosoftStickyNotes` | Productivity app |
| `Microsoft.Todos` | Task management app |
| `Microsoft.WindowsNotepad` | Essential text editor |
| `Microsoft.WindowsTerminal` | Modern terminal application |

---

## DefaultUserSettings.json

### Changes Required

| Setting | Current | Change To | Reason |
|---------|---------|-----------|--------|
| `NoToastApplicationNotification` | Skip | **Apply** | Disable toast notifications as requested |
| `TurnOffWindowsCopilot` | Skip | **Keep as Skip** | Keep Copilot enabled |

### REMOVE These Settings

Remove Edge update suppression settings (let Autopatch manage):

| Setting to Remove | Reason |
|-------------------|--------|
| `UpdatesSuppressedDurationMin` | Conflicts with Windows Autopatch |
| `UpdatesSuppressedStartHour` | Conflicts with Windows Autopatch |
| `UpdatesSuppressedStartMin` | Conflicts with Windows Autopatch |

---

## PolicyRegSettings.json

### Do NOT Apply (Keep OptimizationState as "Skip")

These settings must remain as Skip for maximum telemetry:

| Setting | Reason |
|---------|--------|
| `CEIPEnable` | Required for Customer Experience data |
| `DisableInventory` | **CRITICAL** - Required for app inventory in Endpoint Analytics |
| `EnableDiagnostics` | Required for scripted diagnostics |
| `EnabledExecution` | Required for scheduled diagnostics |
| All `ScenarioExecutionEnabled` (7 WDI GUIDs) | Required for diagnostic scenarios |

### Set to Apply

| Setting | Value | Reason |
|---------|-------|--------|
| `DoNotShowFeedbackNotifications` | 1 | Safe to apply - UI only |
| `DisableSetup` (WinRE) | 1 | Disable Windows RE setup for Cloud PC |

### REMOVE These Settings - Internet Explorer (Deprecated for Windows 11)

Remove all Internet Explorer settings as IE is not available in Windows 11:

| Setting to Remove | Registry Path |
|-------------------|---------------|
| `AllowServicePoweredQSA` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer` |
| `EnableAutoUpgrade` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main` |
| `DisableFirstRunCustomize` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main` |
| `Play_Animations` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main` |
| `Play_Background_Sounds` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main` |
| `Display Inline Videos` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main` |
| `TabProcGrowth` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main` |
| `PhoneNumberEnabled` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main\FormatDetection` |
| `PolicyDisableGeolocation` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Geolocation` |
| `NoSplash` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Infodelivery\Restrictions` |
| `NoUpdateCheck` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Infodelivery\Restrictions` |
| `DisableCustomerImprovementProgram` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\SQM` |
| `AutoRecover` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Recovery` |
| `Suggested Sites (Apply)` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Suggested Sites` |
| `FlipAhead (Apply)` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\FlipAhead` |
| `PrefetchPrerender (Apply)` | `HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\PrefetchPrerender` |

### REMOVE These Settings - Edge Update Suppression

Remove Edge update suppression (let Autopatch manage):

| Setting to Remove | Reason |
|-------------------|--------|
| `UpdatesSuppressedDurationMin` | Conflicts with Windows Autopatch |
| `UpdatesSuppressedStartHour` | Conflicts with Windows Autopatch |
| `UpdatesSuppressedStartMin` | Conflicts with Windows Autopatch |

---

## LanManWorkstation.json

### REMOVE ENTIRE FILE

This file should be removed for Windows 365 Cloud PC environments:
- Cloud PCs on Microsoft-hosted network don't use SMB file sharing
- LanmanServer and LanmanWorkstation services will be disabled
- SMB tuning settings are irrelevant when SMB is disabled

---

## Windows_Optimization.ps1

### Modification Required

Update the `Optimize-WDOTNetworkOptimizations` function call to handle missing LanManWorkstation.json gracefully:

**File:** `Functions\Optimize-WDOTNetworkOptimizations.ps1`

The function already checks for file existence with `Test-Path`, but verify it handles the missing file without error.

---

## Quick Reference - Settings Protection Matrix

### Services - NEVER Disable for Intune/Azure Monitor

```
DiagTrack ────────── Endpoint Analytics telemetry
DPS ──────────────── Diagnostic Policy Service
WdiSystemHost ────── Diagnostic hosting
WerSvc ───────────── App reliability / error reporting
DiagSvc ──────────── Diagnostic execution
InstallService ───── Store app installation
VSS ──────────────── Point-in-time restore
```

### Scheduled Tasks - NEVER Disable for Intune/Azure Monitor

```
*Compatibility* ──────────────────────── App compatibility / Endpoint Analytics
Microsoft-Windows-DiskDiagnosticDataCollector ── Disk telemetry
Consolidator ─────────────────────────── CEIP data
Sqm-Tasks ────────────────────────────── TPM/Secure Boot compliance
```

### Policies - NEVER Apply for Maximum Telemetry

```
CEIPEnable = 0 ─────────────── Disables CEIP
DisableInventory = 1 ─────────── Breaks app inventory
EnableDiagnostics = 0 ─────────── Disables diagnostics
EnabledExecution = 0 ──────────── Disables scheduled diagnostics
ScenarioExecutionEnabled = 0 ──── Disables WDI scenarios
```

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | Original | Initial release |
| 1.1 | TBD | Windows 365 Cloud PC optimizations with Intune/Azure Monitor compatibility |
